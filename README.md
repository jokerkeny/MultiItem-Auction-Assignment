# 多物品拍卖（最优分配算法）
目的是把总价为$P'$的n个物品更有效的分配给n个人，实现最大效用
## 封闭报价
n个竞拍者封闭报价，给出自己对n个物品的报价，反映n个物品对自己的效用，形成报价矩阵$S_ij$
$$
\begin{bmatrix}
S_{11} & S_{12} & \cdots & S_{1n}\\
S_{21} & S_{22} & \cdots & S_{2n}\\
\vdots & \vdots & \ddots & \vdots\\
S_{n1} & S_{n2} & \cdots & S_{nn}
\end{bmatrix}
$$
其中第1行$S_{11},\  S_{12},\  \cdots,\  S_{1n}$即第1个人对n个物品的报价。
...以此类推

每行之和，即每个人的对所有物品的报价和，都等于原始n个物品的总价$P'$

## 物品分配
(虚拟)卖家将挑选出最优报价组合$(S_{i_{1}1},S_{i_{2}2},...,S_{i_{n}n})$，使报价组合的总价格$P = S_{i_{1}1}+S_{i_{2}2}+...+S_{i_{n}n}$最高
其中$i_1,i_2,...,i_n$代表矩阵中互不相同的n行，即n个不一样的人

物品1将分配给第$i_1$个人
物品2将分配给第$i_2$个人
......以此类推

## 实际支出
n个物品原本的总价是固定的$P'$（比方说$3500）
显然，拍卖后卖家挑选的最优报价组合的总价格 $P\ge P'$（仅在所有人报价完全一致时取等）

由于本方案的目的是更好的分配物品，拍卖的卖家是虚拟的，不需盈利。所以我们要使得所有人的实际支出和等于物品的原始总价。

此处给出两种方法，第一种熟悉的**Normalize正则化**基于比例差异，第二种**均匀返现**基于绝对值差异，绝对值差异在数学上会更严谨。但严谨程度都取决于竞拍人在报价反映自身效用时的想法。
### Normalize正则化
设正则项
$$||N|| = \frac{P}{P'}$$
其中$P$为最优报价组合的总价格，$P'$为n个物品原始价格总额。
设第i个人在最优组合中被分配到了物品j，
则每个人调整后的实际支出为
$$S'_{ij}=\frac{S_{ij}}{||N||}$$


### 均匀返现
虚拟卖家把超额利润$P-P'$均分给所有n个竞拍者，即
$$S'_{ij}=S_{ij} - \frac{P-P'}{n}$$

## 最终效果
可以看出，每个人的实际支出$S'$都将小于他对该物品的原报价$S$。因此可以看出，经过组合团购/拍卖交易后，每个人获得的效用增加了。


# 基于google sheet&colab的一个简单实现方法
step 1:每个人准备好自己的报价写进自己私人的google sheet
step 2:过3分钟，大家把自己的报价sheet的只读sharelink，一起公开。（由于google sheet的修改记录是可见的，可验证3分钟内不存在报价变动。）
step 3:在colab里打开程序，输入报价并运行。

其中step1 & 2是用于可靠的封闭报价的，sharelink得一起公开，否则存在事先准备好多个googlesheet的作弊漏洞。
如果在现实中当面报价，Step 1 & 2可直接用纸笔封闭报价代替。
如果不在意可靠的封闭报价，这些都可以省略，代之以直接口述/微信报出价格。
